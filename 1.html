<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Envirocar Movement data</title>
  <link rel="stylesheet" href="lib/leaflet/leaflet.css">
  <link rel="stylesheet" href="dist/control.playback.css">
  <script src='//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script src="lib/leaflet/leaflet.js"></script>
  <script src="dist/control.trackplayback.js"></script>
  <script src="dist/leaflet.trackplayback.js"></script>
</head>

<body>
  <div id='mapid'
    style=" position: absolute; left: 0; top: 0; right: 0; bottom: 0; width: 100%; height: 100%; overflow: hidden;">
  </div>
  <script>
 
    datageojson = []
    $.ajax({
      dataType: "json",
      url: "./data/output1.geojson",
      success: function (data1) {
        prevId = ''

        $(data1.features).each(function (key, data2) {
          id = data2.properties['track.id'];
          lat = data2.geometry.coordinates[1]
          lng = data2.geometry.coordinates[0]
          time = Date.parse(data2.properties['time'])/1000
          if (prevId == '') {
            array1 = [];
            array1 = [{
              "lng": lng,
              "lat": lat,
              "time": time
            }]
            prevId = id
          } else {
            if (prevId == id) {
              array1.push({
                "lng": lng,
                "lat": lat,
                "time": time
              })
            } else {
              datageojson.push(array1)
              array1 = [];
              array1 = [{
                "lng": lng,
                "lat": lat,
                "time": time
              }]
              prevId = id
            }
          }
        });

        const map = L.map('mapid').setView([51.2,6.5], 12);
        var Stadia_AlidadeSmoothDark = L.tileLayer(
          'https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
            maxZoom: 20,
            attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
          });
        Stadia_AlidadeSmoothDark.addTo(map)
        // L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        //   attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        // }).addTo(map);

        const trackplayback = L.trackplayback(datageojson, map, {
          targetOptions: {
            useImg: true,
            imgUrl: './ship.png'
          }
        });
        const trackplaybackControl = L.trackplaybackcontrol(trackplayback);
        trackplaybackControl.addTo(map);
      }

    }).error(function () {});
    
  </script>
</body>

</html>
